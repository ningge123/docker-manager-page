import{g as k}from"./server-fb07f2cf.js";import{q as v,_ as M,K as R,r as g,A as T,o as u,c as h,a as _,b as s,w as l,I,J as w,y as S,x as N,e as d,t as c}from"./index-b9d46688.js";import{a as Q,f as P}from"./docker-6b00f3d6.js";import{E as B}from"./Search-553ae5af.js";function E(e){return v({url:"/mgr/image/list",method:"get",params:e})}function F(e,a){return v({url:"/mgr/image/"+e,method:"post",data:a})}function O(e){return console.log("getImage.params:",e),v({url:"/mgr/image/detail",method:"get",params:e})}const U={components:{},data(){return{list:[],page:{currentPage:1,pageSize:10,total:0},groupList:[],groups:{},listLoading:!1,detailLoading:!1,dialogDetailVisible:!1,selectRow:{},res:{serverNames:[]},listQuery:{serverNames:[]},filterText:"",search:"",ElIconSearch:B}},computed:{},created(){this.fetchData(),this.fetchServerNames()},methods:{statusFilter_filter(e){return{published:"success",draft:"gray",deleted:"danger"}[e]},ImageOperator(e,a){this.listLoading=!0;const i={ImageId:a.ImageId,serverName:a.ServerName};F(e,i).then(o=>{o.code==="100200"&&(this.$message({message:this.$t("命令下发成功"),type:"success"}),this.fetchData()),this.listLoading=!1})},fetchServerNames(){k().then(e=>{this.res.serverNames=e.data})},handleSizeChange(e){console.log(`每页 ${e} 条`),this.page.pageSize=e,this.fetchData()},handleCurrentChange(e){console.log(`当前页: ${e}`),this.page.currentPage=e,this.fetchData()},fetchData(){this.listLoading=!0,this.listQuery.currentPage=this.page.currentPage,this.listQuery.pageSize=this.page.pageSize,E(this.listQuery).then(e=>{this.list=e.data.list,this.page=e.data.page,this.list||(this.list=[]),this.list.sort(function(a,i){return a.ServerName.localeCompare(i.ServerName)}),this.groupList=new Set(this.list.map(a=>a.ServerName)),this.groups={};for(let a=0;a<this.list.length;a++){const i=this.list[a];let o=this.groups[i.ServerName];o||(o={ServerName:i.ServerName,Members:0,StartIdx:a}),o.Members=o.Members+1,this.groups[i.ServerName]=o}this.listLoading=!1})},spanMethod(e){const{row:a,rowIndex:i,columnIndex:o}=e;if(o===1){const r=this.groups[a.ServerName];return i===r.StartIdx?{rowspan:r.Members,colspan:1}:{rowspan:0,colspan:0}}else return{rowspan:1,colspan:1}},formatDate(e){return R(e)},FormatName(e){return Q(e)},formatSize(e){return P(e)},formatTags(e){return e.split(",")},formatImageId(e){return e.substr(7,12)},openDetail(e){this.dialogDetailVisible=!0,this.detailLoading=!0,this.selectRow=e;const a={ImageId:e.ImageId};O(a).then(i=>{this.detailLoading=!1,this.selectRow=i.data,console.log(i.data)})}}},J={class:"app-container"},j={class:"filter-container"},q=d(" Search "),A=d(" Tags "),K={style:{"text-indent":"-2em"}};function G(e,a,i,o,r,n){const C=g("el-option"),y=g("el-select"),f=g("el-button"),m=g("el-table-column"),D=g("el-input"),z=g("el-tooltip"),L=g("el-table"),x=g("el-pagination"),V=g("el-dialog"),b=T("loading");return u(),h("div",J,[_("div",j,[s(y,{modelValue:r.listQuery.serverNames,"onUpdate:modelValue":a[0]||(a[0]=t=>r.listQuery.serverNames=t),multiple:"",filterable:"",placeholder:e.$t("主机"),clearable:"","collapse-tags":"",class:"filter-item",style:{width:"300px","margin-right":"10px"}},{default:l(()=>[(u(!0),h(I,null,w(r.res.serverNames,t=>(u(),S(C,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),s(f,{class:"filter-item",type:"primary",icon:r.ElIconSearch,onClick:n.fetchData},{default:l(()=>[q]),_:1},8,["icon","onClick"])]),N((u(),S(L,{ref:"tableList",data:r.list.filter(t=>!r.search||t.RepoTags.toLowerCase().includes(r.search.toLowerCase())),"span-method":n.spanMethod,"element-loading-text":"Loading",stripe:"",border:"",fit:"","highlight-current-row":"",class:"filter-tree",style:{"margin-top":"20px"}},{default:l(()=>[s(m,{align:"center",label:"ID",width:"65"},{default:l(t=>[d(c(t.$index+1),1)]),_:1}),s(m,{label:"ServerName",width:"170"},{default:l(t=>[d(c(t.row.ServerName),1)]),_:1}),s(m,{label:"RepoDigests",align:"center"},{default:l(t=>[d(c(t.row.RepoDigests.split("@")[0]),1)]),_:1}),s(m,{label:"Tags",align:"center"},{header:l(()=>[A,s(D,{modelValue:r.search,"onUpdate:modelValue":a[1]||(a[1]=t=>r.search=t),size:"small",placeholder:e.$t("输入关键字过滤"),style:{width:"140px"}},null,8,["modelValue","placeholder"])]),default:l(t=>[(u(!0),h(I,null,w(n.formatTags(t.row.RepoTags),p=>(u(),h("div",{key:p},c(p),1))),128))]),_:1}),s(m,{label:"ImageId",align:"center"},{default:l(t=>[s(z,{class:"item",effect:"dark",content:t.row.ImageId,placement:"top-start"},{default:l(()=>[s(f,{type:"primary",link:"",onClick:p=>n.openDetail(t.row)},{default:l(()=>[d(c(n.formatImageId(t.row.ImageId)),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1}),s(m,{label:"Size",align:"center"},{default:l(t=>[d(c(n.formatSize(t.row.Size)),1)]),_:1}),s(m,{align:"center",prop:"created_at",label:"Created",width:"200"},{default:l(t=>[_("span",null,c(n.formatDate(t.row.Created)),1)]),_:1}),s(m,{"class-name":"status-col",label:e.$t("操作"),width:"170",align:"center"},{default:l(t=>[s(f,{loading:r.listLoading,type:"danger",link:"",onClick:p=>n.ImageOperator("remove",t.row)},{default:l(()=>[d(c(e.$t("删除")),1)]),_:2},1032,["loading","onClick"])]),_:1},8,["label"])]),_:1},8,["data","span-method"])),[[b,r.listLoading]]),s(x,{"hide-on-single-page":!0,style:{width:"500px",margin:"10px auto 0"},"current-page":r.page.currentPage,"page-sizes":[10,30,50,100,200,300,400],"page-size":r.page.pageSize,total:r.page.total,layout:"prev, pager, next, jumper, sizes, total",onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"]),N((u(),S(V,{modelValue:r.dialogDetailVisible,"onUpdate:modelValue":a[2]||(a[2]=t=>r.dialogDetailVisible=t),title:e.$t("详情")},{default:l(()=>[_("pre",K,"    "+c(JSON.stringify(r.selectRow,null,2))+`
          `,1)]),_:1},8,["modelValue","title"])),[[b,r.detailLoading]])])}const Z=M(U,[["render",G]]);export{Z as default};
